{"ast":null,"code":"import _ from \"lodash\";\nconsole.log(\"dataTransforms is loaded\"); // 加在檔案最上方，確認檔案有被載入\n\nexport const processCampaignData = data => {\n  // 確保輸入資料是陣列\n  if (!Array.isArray(data)) {\n    console.error(\"Input data is not an array\");\n    return {\n      stats: [],\n      best: null,\n      trends: []\n    };\n  }\n  // 處理基本統計數據\n  const stats = _(data).groupBy(\"Campaign Name\").map((campaign, name) => {\n    // 首先列印出原始數據來看看\n    //console.log(\"Campaign raw data:\", name, campaign);\n    const totalImpressions = _.sumBy(campaign, \"Impressions\");\n    const totalClicks = _.sumBy(campaign, \"Clicks\");\n    const totalOrders = _.sumBy(campaign, \"7 Day Total Orders (#)\");\n    const totalSpend = _.sumBy(campaign, row => {\n      // 檢查支出的轉換過程\n      const spendValue = parseFloat(row[\"Spend\"].replace(\"$\", \"\")) || 0;\n      //console.log(\"Spend value:\", row[\"Spend\"], \"->\", spendValue);\n      return spendValue;\n    });\n    const totalSales = _.sumBy(campaign, row => {\n      // 檢查銷售額的轉換過程\n      const saleValue = parseFloat(row[\"7 Day Total Sales \"].replace(\"$\", \"\")) || 0;\n      //console.log(\"Sale value:\", row[\"7 Day Total Sales \"], \"->\", saleValue);\n      return saleValue;\n    });\n\n    // 檢查計算 ACOS 的值\n    //console.log(\"Total sales:\", totalSales);\n    //console.log(\"Total spend:\", totalSpend);\n\n    let acos = null;\n    if (totalSales > 0) {\n      // 明確檢查銷售額是否大於0\n      acos = (totalSpend / totalSales * 100).toFixed(2);\n    }\n    console.log(\"Calculated ACOS:\", acos);\n    return {\n      name,\n      impressions: totalImpressions,\n      clicks: totalClicks,\n      orders: totalOrders,\n      spend: totalSpend,\n      sales: totalSales,\n      CTR: totalImpressions ? (totalClicks / totalImpressions * 100).toFixed(2) : 0,\n      CPC: totalClicks ? (totalSpend / totalClicks).toFixed(2) : 0,\n      ACOS: totalSales ? (totalSpend / totalSales * 100).toFixed(2) : null,\n      ROAS: totalSpend ? (totalSales / totalSpend).toFixed(2) : 0,\n      conversionRate: totalClicks ? (totalOrders / totalClicks * 100).toFixed(2) : 0\n    };\n  }).value();\n\n  // 計算最佳表現\n  const best = {\n    highestROAS: _.maxBy(stats, \"ROAS\"),\n    lowestACOS: _.minBy(stats.filter(c => parseFloat(c.ACOS) > 0), \"ACOS\"),\n    highestCTR: _.maxBy(stats, c => parseFloat(c.CTR)),\n    highestConversion: _.maxBy(stats, c => parseFloat(c.conversionRate))\n  };\n\n  // 處理趨勢資料\n  const trends = _(data).groupBy(row => row[\"Start Date\"]) // 根據日期分組\n  .map((dayData, date) => ({\n    date,\n    // x軸的日期\n    sales: _.sumBy(dayData, row => parseFloat(row[\"7 Day Total Sales \"].replace(\"$\", \"\")) || 0),\n    // 銷售額\n    spend: _.sumBy(dayData, row => parseFloat(row[\"Spend\"].replace(\"$\", \"\")) || 0),\n    // 廣告支出\n    ACOS: (() => {\n      const sales = _.sumBy(dayData, row => parseFloat(row[\"7 Day Total Sales \"].replace(\"$\", \"\")) || 0);\n      const spend = _.sumBy(dayData, row => parseFloat(row[\"Spend\"].replace(\"$\", \"\")) || 0);\n      return sales > 0 ? (spend / sales * 100).toFixed(2) : null;\n    })()\n  })).orderBy(\"date\", \"asc\") // 根據日期排序\n  .value();\n  return {\n    stats,\n    best,\n    trends\n  };\n};\n\n// dataTransforms.js\nexport const processTrendData = (data, timeGranularity, compareMode) => {\n  return _(data).groupBy(row => {\n    const date = new Date(row[\"Start Date\"]);\n    switch (timeGranularity) {\n      case \"week\":\n        const weekStart = new Date(date);\n        weekStart.setDate(date.getDate() - date.getDay());\n        return weekStart.toISOString().split(\"T\")[0];\n      case \"month\":\n        return `${date.getFullYear()}-${String(date.getMonth() + 1).padStart(2, \"0\")}`;\n      default:\n        // day\n        return row[\"Start Date\"];\n    }\n  }).map((group, date) => {\n    const totalSales = _.sumBy(group, row => parseFloat(row[\"7 Day Total Sales \"].replace(\"$\", \"\")) || 0);\n    const totalSpend = _.sumBy(group, row => parseFloat(row[\"Spend\"].replace(\"$\", \"\")) || 0);\n\n    // 根據比較模式處理數據\n    const campaignData = compareMode === \"separate\" ? _.groupBy(group, \"Campaign Name\") : null;\n    return {\n      date,\n      sales: totalSales,\n      spend: totalSpend,\n      ACOS: totalSales > 0 ? (totalSpend / totalSales * 100).toFixed(2) : null,\n      campaignData // 當 compareMode 為 \"separate\" 時才會有值\n    };\n  }).orderBy(\"date\", \"asc\").value();\n};","map":{"version":3,"names":["_","console","log","processCampaignData","data","Array","isArray","error","stats","best","trends","groupBy","map","campaign","name","totalImpressions","sumBy","totalClicks","totalOrders","totalSpend","row","spendValue","parseFloat","replace","totalSales","saleValue","acos","toFixed","impressions","clicks","orders","spend","sales","CTR","CPC","ACOS","ROAS","conversionRate","value","highestROAS","maxBy","lowestACOS","minBy","filter","c","highestCTR","highestConversion","dayData","date","orderBy","processTrendData","timeGranularity","compareMode","Date","weekStart","setDate","getDate","getDay","toISOString","split","getFullYear","String","getMonth","padStart","group","campaignData"],"sources":["C:/python-training/eyeglad/campaign-analytics/src/utils/dataTransforms.js"],"sourcesContent":["import _ from \"lodash\";\r\n\r\nconsole.log(\"dataTransforms is loaded\"); // 加在檔案最上方，確認檔案有被載入\r\n\r\nexport const processCampaignData = (data) => {\r\n  // 確保輸入資料是陣列\r\n  if (!Array.isArray(data)) {\r\n    console.error(\"Input data is not an array\");\r\n    return { stats: [], best: null, trends: [] };\r\n  }\r\n  // 處理基本統計數據\r\n  const stats = _(data)\r\n    .groupBy(\"Campaign Name\")\r\n    .map((campaign, name) => {\r\n      // 首先列印出原始數據來看看\r\n      //console.log(\"Campaign raw data:\", name, campaign);\r\n      const totalImpressions = _.sumBy(campaign, \"Impressions\");\r\n      const totalClicks = _.sumBy(campaign, \"Clicks\");\r\n      const totalOrders = _.sumBy(campaign, \"7 Day Total Orders (#)\");\r\n      const totalSpend = _.sumBy(campaign, (row) => {\r\n        // 檢查支出的轉換過程\r\n        const spendValue = parseFloat(row[\"Spend\"].replace(\"$\", \"\")) || 0;\r\n        //console.log(\"Spend value:\", row[\"Spend\"], \"->\", spendValue);\r\n        return spendValue;\r\n      });\r\n      const totalSales = _.sumBy(campaign, (row) => {\r\n        // 檢查銷售額的轉換過程\r\n        const saleValue =\r\n          parseFloat(row[\"7 Day Total Sales \"].replace(\"$\", \"\")) || 0;\r\n        //console.log(\"Sale value:\", row[\"7 Day Total Sales \"], \"->\", saleValue);\r\n        return saleValue;\r\n      });\r\n\r\n      // 檢查計算 ACOS 的值\r\n      //console.log(\"Total sales:\", totalSales);\r\n      //console.log(\"Total spend:\", totalSpend);\r\n\r\n      let acos = null;\r\n      if (totalSales > 0) {\r\n        // 明確檢查銷售額是否大於0\r\n        acos = ((totalSpend / totalSales) * 100).toFixed(2);\r\n      }\r\n      console.log(\"Calculated ACOS:\", acos);\r\n\r\n      return {\r\n        name,\r\n        impressions: totalImpressions,\r\n        clicks: totalClicks,\r\n        orders: totalOrders,\r\n        spend: totalSpend,\r\n        sales: totalSales,\r\n        CTR: totalImpressions\r\n          ? ((totalClicks / totalImpressions) * 100).toFixed(2)\r\n          : 0,\r\n        CPC: totalClicks ? (totalSpend / totalClicks).toFixed(2) : 0,\r\n        ACOS: totalSales ? ((totalSpend / totalSales) * 100).toFixed(2) : null,\r\n        ROAS: totalSpend ? (totalSales / totalSpend).toFixed(2) : 0,\r\n        conversionRate: totalClicks\r\n          ? ((totalOrders / totalClicks) * 100).toFixed(2)\r\n          : 0,\r\n      };\r\n    })\r\n    .value();\r\n\r\n  // 計算最佳表現\r\n  const best = {\r\n    highestROAS: _.maxBy(stats, \"ROAS\"),\r\n    lowestACOS: _.minBy(\r\n      stats.filter((c) => parseFloat(c.ACOS) > 0),\r\n      \"ACOS\"\r\n    ),\r\n    highestCTR: _.maxBy(stats, (c) => parseFloat(c.CTR)),\r\n    highestConversion: _.maxBy(stats, (c) => parseFloat(c.conversionRate)),\r\n  };\r\n\r\n  // 處理趨勢資料\r\n  const trends = _(data)\r\n    .groupBy((row) => row[\"Start Date\"]) // 根據日期分組\r\n    .map((dayData, date) => ({\r\n      date, // x軸的日期\r\n      sales: _.sumBy(\r\n        dayData,\r\n        (row) => parseFloat(row[\"7 Day Total Sales \"].replace(\"$\", \"\")) || 0\r\n      ), // 銷售額\r\n      spend: _.sumBy(\r\n        dayData,\r\n        (row) => parseFloat(row[\"Spend\"].replace(\"$\", \"\")) || 0\r\n      ), // 廣告支出\r\n      ACOS: (() => {\r\n        const sales = _.sumBy(\r\n          dayData,\r\n          (row) => parseFloat(row[\"7 Day Total Sales \"].replace(\"$\", \"\")) || 0\r\n        );\r\n        const spend = _.sumBy(\r\n          dayData,\r\n          (row) => parseFloat(row[\"Spend\"].replace(\"$\", \"\")) || 0\r\n        );\r\n        return sales > 0 ? ((spend / sales) * 100).toFixed(2) : null;\r\n      })(),\r\n    }))\r\n    .orderBy(\"date\", \"asc\") // 根據日期排序\r\n    .value();\r\n\r\n  return { stats, best, trends };\r\n};\r\n\r\n// dataTransforms.js\r\nexport const processTrendData = (data, timeGranularity, compareMode) => {\r\n  return _(data)\r\n    .groupBy((row) => {\r\n      const date = new Date(row[\"Start Date\"]);\r\n      switch (timeGranularity) {\r\n        case \"week\":\r\n          const weekStart = new Date(date);\r\n          weekStart.setDate(date.getDate() - date.getDay());\r\n          return weekStart.toISOString().split(\"T\")[0];\r\n        case \"month\":\r\n          return `${date.getFullYear()}-${String(date.getMonth() + 1).padStart(\r\n            2,\r\n            \"0\"\r\n          )}`;\r\n        default: // day\r\n          return row[\"Start Date\"];\r\n      }\r\n    })\r\n    .map((group, date) => {\r\n      const totalSales = _.sumBy(\r\n        group,\r\n        (row) => parseFloat(row[\"7 Day Total Sales \"].replace(\"$\", \"\")) || 0\r\n      );\r\n      const totalSpend = _.sumBy(\r\n        group,\r\n        (row) => parseFloat(row[\"Spend\"].replace(\"$\", \"\")) || 0\r\n      );\r\n\r\n      // 根據比較模式處理數據\r\n      const campaignData =\r\n        compareMode === \"separate\" ? _.groupBy(group, \"Campaign Name\") : null;\r\n\r\n      return {\r\n        date,\r\n        sales: totalSales,\r\n        spend: totalSpend,\r\n        ACOS:\r\n          totalSales > 0 ? ((totalSpend / totalSales) * 100).toFixed(2) : null,\r\n        campaignData, // 當 compareMode 為 \"separate\" 時才會有值\r\n      };\r\n    })\r\n    .orderBy(\"date\", \"asc\")\r\n    .value();\r\n};\r\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}