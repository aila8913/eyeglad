{"ast":null,"code":"import _ from \"lodash\";\nconsole.log(\"dataTransforms is loaded\"); // 加在檔案最上方，確認檔案有被載入\n\nexport const processCampaignData = data => {\n  // 確保輸入資料是陣列\n  if (!Array.isArray(data)) {\n    console.error(\"Input data is not an array\");\n    return {\n      stats: [],\n      best: null\n    };\n  }\n  const stats = _(data).groupBy(\"Campaign Name\").map((campaign, name) => {\n    // 首先列印出原始數據來看看\n    //console.log(\"Campaign raw data:\", name, campaign);\n    const totalImpressions = _.sumBy(campaign, \"Impressions\");\n    const totalClicks = _.sumBy(campaign, \"Clicks\");\n    const totalOrders = _.sumBy(campaign, \"7 Day Total Orders (#)\");\n    const totalSpend = _.sumBy(campaign, row => {\n      // 檢查支出的轉換過程\n      const spendValue = parseFloat(row[\"Spend\"].replace(\"$\", \"\")) || 0;\n      //console.log(\"Spend value:\", row[\"Spend\"], \"->\", spendValue);\n      return spendValue;\n    });\n    const totalSales = _.sumBy(campaign, row => {\n      // 檢查銷售額的轉換過程\n      const saleValue = parseFloat(row[\"7 Day Total Sales \"].replace(\"$\", \"\")) || 0;\n      //console.log(\"Sale value:\", row[\"7 Day Total Sales \"], \"->\", saleValue);\n      return saleValue;\n    });\n\n    // 檢查計算 ACOS 的值\n    //console.log(\"Total sales:\", totalSales);\n    //console.log(\"Total spend:\", totalSpend);\n\n    let acos = null;\n    if (totalSales > 0) {\n      // 明確檢查銷售額是否大於0\n      acos = (totalSpend / totalSales * 100).toFixed(2);\n    }\n    console.log(\"Calculated ACOS:\", acos);\n    return {\n      name,\n      impressions: totalImpressions,\n      clicks: totalClicks,\n      orders: totalOrders,\n      spend: totalSpend,\n      sales: totalSales,\n      CTR: totalImpressions ? (totalClicks / totalImpressions * 100).toFixed(2) : 0,\n      CPC: totalClicks ? (totalSpend / totalClicks).toFixed(2) : 0,\n      ACOS: totalSales ? (totalSpend / totalSales * 100).toFixed(2) : null,\n      ROAS: totalSpend ? (totalSales / totalSpend).toFixed(2) : 0,\n      conversionRate: totalClicks ? (totalOrders / totalClicks * 100).toFixed(2) : 0\n    };\n  }).value();\n  const best = {\n    highestROAS: _.maxBy(stats, \"ROAS\"),\n    lowestACOS: _.minBy(stats.filter(c => parseFloat(c.ACOS) > 0), \"ACOS\"),\n    highestCTR: _.maxBy(stats, c => parseFloat(c.CTR)),\n    highestConversion: _.maxBy(stats, c => parseFloat(c.conversionRate))\n  };\n  return {\n    stats: Array.isArray(stats) ? stats : [],\n    best: best || null // 如果 best 為 undefined 則返回 null\n  };\n};\nexport const processTrendData = (data, timeGranularity) => {\n  return _(data).groupBy(row => {\n    const date = new Date(row[\"Start Date\"]);\n    if (timeGranularity === \"week\") {\n      const weekStart = new Date(date);\n      weekStart.setDate(date.getDate() - date.getDay());\n      return weekStart.toISOString().split(\"T\")[0];\n    } else if (timeGranularity === \"month\") {\n      return `${date.getFullYear()}-${String(date.getMonth() + 1).padStart(2, \"0\")}`;\n    }\n    return row[\"Start Date\"];\n  }).map((group, date) => {\n    const totalSales = _.sumBy(group, row => parseFloat(row[\"7 Day Total Sales \"].replace(\"$\", \"\")) || 0);\n    const totalSpend = _.sumBy(group, row => parseFloat(row[\"Spend\"].replace(\"$\", \"\")) || 0);\n    return {\n      date,\n      sales: totalSales,\n      spend: totalSpend,\n      // 修改 ACOS 的計算邏輯\n      ACOS: totalSales > 0 ? (totalSpend / totalSales * 100).toFixed(2) : null // 當 sales 為 0 時返回 null\n    };\n  }).value();\n};","map":{"version":3,"names":["_","console","log","processCampaignData","data","Array","isArray","error","stats","best","groupBy","map","campaign","name","totalImpressions","sumBy","totalClicks","totalOrders","totalSpend","row","spendValue","parseFloat","replace","totalSales","saleValue","acos","toFixed","impressions","clicks","orders","spend","sales","CTR","CPC","ACOS","ROAS","conversionRate","value","highestROAS","maxBy","lowestACOS","minBy","filter","c","highestCTR","highestConversion","processTrendData","timeGranularity","date","Date","weekStart","setDate","getDate","getDay","toISOString","split","getFullYear","String","getMonth","padStart","group"],"sources":["C:/python-training/eyeglad/campaign-analytics/src/utils/dataTransforms.js"],"sourcesContent":["import _ from \"lodash\";\r\n\r\nconsole.log(\"dataTransforms is loaded\"); // 加在檔案最上方，確認檔案有被載入\r\n\r\nexport const processCampaignData = (data) => {\r\n  // 確保輸入資料是陣列\r\n  if (!Array.isArray(data)) {\r\n    console.error(\"Input data is not an array\");\r\n    return { stats: [], best: null };\r\n  }\r\n  const stats = _(data)\r\n    .groupBy(\"Campaign Name\")\r\n    .map((campaign, name) => {\r\n      // 首先列印出原始數據來看看\r\n      //console.log(\"Campaign raw data:\", name, campaign);\r\n      const totalImpressions = _.sumBy(campaign, \"Impressions\");\r\n      const totalClicks = _.sumBy(campaign, \"Clicks\");\r\n      const totalOrders = _.sumBy(campaign, \"7 Day Total Orders (#)\");\r\n      const totalSpend = _.sumBy(campaign, (row) => {\r\n        // 檢查支出的轉換過程\r\n        const spendValue = parseFloat(row[\"Spend\"].replace(\"$\", \"\")) || 0;\r\n        //console.log(\"Spend value:\", row[\"Spend\"], \"->\", spendValue);\r\n        return spendValue;\r\n      });\r\n      const totalSales = _.sumBy(campaign, (row) => {\r\n        // 檢查銷售額的轉換過程\r\n        const saleValue =\r\n          parseFloat(row[\"7 Day Total Sales \"].replace(\"$\", \"\")) || 0;\r\n        //console.log(\"Sale value:\", row[\"7 Day Total Sales \"], \"->\", saleValue);\r\n        return saleValue;\r\n      });\r\n\r\n      // 檢查計算 ACOS 的值\r\n      //console.log(\"Total sales:\", totalSales);\r\n      //console.log(\"Total spend:\", totalSpend);\r\n\r\n      let acos = null;\r\n      if (totalSales > 0) {\r\n        // 明確檢查銷售額是否大於0\r\n        acos = ((totalSpend / totalSales) * 100).toFixed(2);\r\n      }\r\n      console.log(\"Calculated ACOS:\", acos);\r\n\r\n      return {\r\n        name,\r\n        impressions: totalImpressions,\r\n        clicks: totalClicks,\r\n        orders: totalOrders,\r\n        spend: totalSpend,\r\n        sales: totalSales,\r\n        CTR: totalImpressions\r\n          ? ((totalClicks / totalImpressions) * 100).toFixed(2)\r\n          : 0,\r\n        CPC: totalClicks ? (totalSpend / totalClicks).toFixed(2) : 0,\r\n        ACOS: totalSales ? ((totalSpend / totalSales) * 100).toFixed(2) : null,\r\n        ROAS: totalSpend ? (totalSales / totalSpend).toFixed(2) : 0,\r\n        conversionRate: totalClicks\r\n          ? ((totalOrders / totalClicks) * 100).toFixed(2)\r\n          : 0,\r\n      };\r\n    })\r\n    .value();\r\n\r\n  const best = {\r\n    highestROAS: _.maxBy(stats, \"ROAS\"),\r\n    lowestACOS: _.minBy(\r\n      stats.filter((c) => parseFloat(c.ACOS) > 0),\r\n      \"ACOS\"\r\n    ),\r\n    highestCTR: _.maxBy(stats, (c) => parseFloat(c.CTR)),\r\n    highestConversion: _.maxBy(stats, (c) => parseFloat(c.conversionRate)),\r\n  };\r\n\r\n  return {\r\n    stats: Array.isArray(stats) ? stats : [],\r\n    best: best || null, // 如果 best 為 undefined 則返回 null\r\n  };\r\n};\r\n\r\nexport const processTrendData = (data, timeGranularity) => {\r\n  return _(data)\r\n    .groupBy((row) => {\r\n      const date = new Date(row[\"Start Date\"]);\r\n      if (timeGranularity === \"week\") {\r\n        const weekStart = new Date(date);\r\n        weekStart.setDate(date.getDate() - date.getDay());\r\n        return weekStart.toISOString().split(\"T\")[0];\r\n      } else if (timeGranularity === \"month\") {\r\n        return `${date.getFullYear()}-${String(date.getMonth() + 1).padStart(\r\n          2,\r\n          \"0\"\r\n        )}`;\r\n      }\r\n      return row[\"Start Date\"];\r\n    })\r\n    .map((group, date) => {\r\n      const totalSales = _.sumBy(\r\n        group,\r\n        (row) => parseFloat(row[\"7 Day Total Sales \"].replace(\"$\", \"\")) || 0\r\n      );\r\n      const totalSpend = _.sumBy(\r\n        group,\r\n        (row) => parseFloat(row[\"Spend\"].replace(\"$\", \"\")) || 0\r\n      );\r\n\r\n      return {\r\n        date,\r\n        sales: totalSales,\r\n        spend: totalSpend,\r\n        // 修改 ACOS 的計算邏輯\r\n        ACOS:\r\n          totalSales > 0 ? ((totalSpend / totalSales) * 100).toFixed(2) : null, // 當 sales 為 0 時返回 null\r\n      };\r\n    })\r\n    .value();\r\n};\r\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}