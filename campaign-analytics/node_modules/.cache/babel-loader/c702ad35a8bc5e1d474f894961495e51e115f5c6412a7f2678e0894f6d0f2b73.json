{"ast":null,"code":"import _ from \"lodash\";\n\n// 應該在 src/utils/dataTransforms.js\nconsole.log(\"dataTransforms is loaded\"); // 加在檔案最上方，確認檔案有被載入\n\nexport const processCampaignData = data => {\n  const stats = _(data).groupBy(\"Campaign Name\").map((campaign, name) => {\n    // 首先列印出原始數據來看看\n    console.log(\"Campaign raw data:\", name, campaign);\n    const totalImpressions = _.sumBy(campaign, \"Impressions\");\n    const totalClicks = _.sumBy(campaign, \"Clicks\");\n    const totalOrders = _.sumBy(campaign, \"7 Day Total Orders (#)\");\n    const totalSpend = _.sumBy(campaign, row => {\n      // 檢查支出的轉換過程\n      const spendValue = parseFloat(row[\"Spend\"].replace(\"$\", \"\")) || 0;\n      console.log(\"Spend value:\", row[\"Spend\"], \"->\", spendValue);\n      return spendValue;\n    });\n    const totalSales = _.sumBy(campaign, row => {\n      // 檢查銷售額的轉換過程\n      const saleValue = parseFloat(row[\"7 Day Total Sales \"].replace(\"$\", \"\")) || 0;\n      console.log(\"Sale value:\", row[\"7 Day Total Sales \"], \"->\", saleValue);\n      return saleValue;\n    });\n\n    // 檢查計算 ACOS 的值\n    console.log(\"Total sales:\", totalSales);\n    console.log(\"Total spend:\", totalSpend);\n    let acos = null;\n    if (totalSales > 0) {\n      // 明確檢查銷售額是否大於0\n      acos = (totalSpend / totalSales * 100).toFixed(2);\n    }\n    console.log(\"Calculated ACOS:\", acos);\n    return {\n      name,\n      impressions: totalImpressions,\n      clicks: totalClicks,\n      orders: totalOrders,\n      spend: totalSpend,\n      sales: totalSales,\n      CTR: totalImpressions ? (totalClicks / totalImpressions * 100).toFixed(2) : 0,\n      CPC: totalClicks ? (totalSpend / totalClicks).toFixed(2) : 0,\n      ACOS: totalSales ? (totalSpend / totalSales * 100).toFixed(2) : null,\n      ROAS: totalSpend ? (totalSales / totalSpend).toFixed(2) : 0,\n      conversionRate: totalClicks ? (totalOrders / totalClicks * 100).toFixed(2) : 0\n    };\n  }).value();\n  const best = {\n    highestROAS: _.maxBy(stats, \"ROAS\"),\n    lowestACOS: _.minBy(stats.filter(c => parseFloat(c.ACOS) > 0), \"ACOS\"),\n    highestCTR: _.maxBy(stats, c => parseFloat(c.CTR)),\n    highestConversion: _.maxBy(stats, c => parseFloat(c.conversionRate))\n  };\n  return {\n    stats,\n    best\n  };\n};\nexport const processTrendData = (data, timeGranularity) => {\n  return _(data).groupBy(row => {\n    const date = new Date(row[\"Start Date\"]);\n    if (timeGranularity === \"week\") {\n      const weekStart = new Date(date);\n      weekStart.setDate(date.getDate() - date.getDay());\n      return weekStart.toISOString().split(\"T\")[0];\n    } else if (timeGranularity === \"month\") {\n      return `${date.getFullYear()}-${String(date.getMonth() + 1).padStart(2, \"0\")}`;\n    }\n    return row[\"Start Date\"];\n  }).map((group, date) => {\n    const totalSales = _.sumBy(group, row => parseFloat(row[\"7 Day Total Sales \"].replace(\"$\", \"\")) || 0);\n    const totalSpend = _.sumBy(group, row => parseFloat(row[\"Spend\"].replace(\"$\", \"\")) || 0);\n    return {\n      date,\n      sales: totalSales,\n      spend: totalSpend,\n      // 修改 ACOS 的計算邏輯\n      ACOS: totalSales > 0 ? (totalSpend / totalSales * 100).toFixed(2) : null // 當 sales 為 0 時返回 null\n    };\n  }).value();\n};","map":{"version":3,"names":["_","console","log","processCampaignData","data","stats","groupBy","map","campaign","name","totalImpressions","sumBy","totalClicks","totalOrders","totalSpend","row","spendValue","parseFloat","replace","totalSales","saleValue","acos","toFixed","impressions","clicks","orders","spend","sales","CTR","CPC","ACOS","ROAS","conversionRate","value","best","highestROAS","maxBy","lowestACOS","minBy","filter","c","highestCTR","highestConversion","processTrendData","timeGranularity","date","Date","weekStart","setDate","getDate","getDay","toISOString","split","getFullYear","String","getMonth","padStart","group"],"sources":["C:/python-training/eyeglad/campaign-analytics/src/utils/dataTransforms.js"],"sourcesContent":["import _ from \"lodash\";\r\n\r\n// 應該在 src/utils/dataTransforms.js\r\nconsole.log(\"dataTransforms is loaded\"); // 加在檔案最上方，確認檔案有被載入\r\n\r\nexport const processCampaignData = (data) => {\r\n  const stats = _(data)\r\n    .groupBy(\"Campaign Name\")\r\n    .map((campaign, name) => {\r\n      // 首先列印出原始數據來看看\r\n      console.log(\"Campaign raw data:\", name, campaign);\r\n      const totalImpressions = _.sumBy(campaign, \"Impressions\");\r\n      const totalClicks = _.sumBy(campaign, \"Clicks\");\r\n      const totalOrders = _.sumBy(campaign, \"7 Day Total Orders (#)\");\r\n      const totalSpend = _.sumBy(campaign, (row) => {\r\n        // 檢查支出的轉換過程\r\n        const spendValue = parseFloat(row[\"Spend\"].replace(\"$\", \"\")) || 0;\r\n        console.log(\"Spend value:\", row[\"Spend\"], \"->\", spendValue);\r\n        return spendValue;\r\n      });\r\n      const totalSales = _.sumBy(campaign, (row) => {\r\n        // 檢查銷售額的轉換過程\r\n        const saleValue =\r\n          parseFloat(row[\"7 Day Total Sales \"].replace(\"$\", \"\")) || 0;\r\n        console.log(\"Sale value:\", row[\"7 Day Total Sales \"], \"->\", saleValue);\r\n        return saleValue;\r\n      });\r\n\r\n      // 檢查計算 ACOS 的值\r\n      console.log(\"Total sales:\", totalSales);\r\n      console.log(\"Total spend:\", totalSpend);\r\n\r\n      let acos = null;\r\n      if (totalSales > 0) {\r\n        // 明確檢查銷售額是否大於0\r\n        acos = ((totalSpend / totalSales) * 100).toFixed(2);\r\n      }\r\n      console.log(\"Calculated ACOS:\", acos);\r\n\r\n      return {\r\n        name,\r\n        impressions: totalImpressions,\r\n        clicks: totalClicks,\r\n        orders: totalOrders,\r\n        spend: totalSpend,\r\n        sales: totalSales,\r\n        CTR: totalImpressions\r\n          ? ((totalClicks / totalImpressions) * 100).toFixed(2)\r\n          : 0,\r\n        CPC: totalClicks ? (totalSpend / totalClicks).toFixed(2) : 0,\r\n        ACOS: totalSales ? ((totalSpend / totalSales) * 100).toFixed(2) : null,\r\n        ROAS: totalSpend ? (totalSales / totalSpend).toFixed(2) : 0,\r\n        conversionRate: totalClicks\r\n          ? ((totalOrders / totalClicks) * 100).toFixed(2)\r\n          : 0,\r\n      };\r\n    })\r\n    .value();\r\n\r\n  const best = {\r\n    highestROAS: _.maxBy(stats, \"ROAS\"),\r\n    lowestACOS: _.minBy(\r\n      stats.filter((c) => parseFloat(c.ACOS) > 0),\r\n      \"ACOS\"\r\n    ),\r\n    highestCTR: _.maxBy(stats, (c) => parseFloat(c.CTR)),\r\n    highestConversion: _.maxBy(stats, (c) => parseFloat(c.conversionRate)),\r\n  };\r\n\r\n  return { stats, best };\r\n};\r\n\r\nexport const processTrendData = (data, timeGranularity) => {\r\n  return _(data)\r\n    .groupBy((row) => {\r\n      const date = new Date(row[\"Start Date\"]);\r\n      if (timeGranularity === \"week\") {\r\n        const weekStart = new Date(date);\r\n        weekStart.setDate(date.getDate() - date.getDay());\r\n        return weekStart.toISOString().split(\"T\")[0];\r\n      } else if (timeGranularity === \"month\") {\r\n        return `${date.getFullYear()}-${String(date.getMonth() + 1).padStart(\r\n          2,\r\n          \"0\"\r\n        )}`;\r\n      }\r\n      return row[\"Start Date\"];\r\n    })\r\n    .map((group, date) => {\r\n      const totalSales = _.sumBy(\r\n        group,\r\n        (row) => parseFloat(row[\"7 Day Total Sales \"].replace(\"$\", \"\")) || 0\r\n      );\r\n      const totalSpend = _.sumBy(\r\n        group,\r\n        (row) => parseFloat(row[\"Spend\"].replace(\"$\", \"\")) || 0\r\n      );\r\n\r\n      return {\r\n        date,\r\n        sales: totalSales,\r\n        spend: totalSpend,\r\n        // 修改 ACOS 的計算邏輯\r\n        ACOS:\r\n          totalSales > 0 ? ((totalSpend / totalSales) * 100).toFixed(2) : null, // 當 sales 為 0 時返回 null\r\n      };\r\n    })\r\n    .value();\r\n};\r\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}